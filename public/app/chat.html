<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المحادثة - مشرق</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/app/assets/css/tailwind.css">
    <link rel="stylesheet" href="/app/assets/css/main.css">
    <link rel="stylesheet" href="/app/assets/css/design-system.css">
    <link rel="stylesheet" href="/app/assets/css/pages/chat.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/app/assets/images/logo.png">
</head>

<body class="bg-gray-50">

    <!-- Navbar -->
    <div id="navbar"></div>

    <!-- Chat Container -->
    <div class="chat-page-container">

        <!-- Chat Sidebar (Conversations List) -->
        <aside class="chat-sidebar" id="chatSidebar">
            <div class="chat-sidebar-header">
                <h2 class="chat-sidebar-title">المحادثات</h2>
                <span class="chat-sidebar-count" id="conversationsCount">0</span>
            </div>

            <!-- Search -->
            <div class="chat-search">
                <svg class="chat-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8" />
                    <path d="M21 21l-4.35-4.35" />
                </svg>
                <input type="text" class="chat-search-input" placeholder="بحث في المحادثات..." id="searchConversations">
            </div>

            <!-- Conversations List -->
            <div class="conversations-list" id="conversationsList">
                <!-- Loading State -->
                <div class="conversations-loading" id="conversationsLoading">
                    <div class="loading-spinner"></div>
                    <span>جاري تحميل المحادثات...</span>
                </div>
            </div>
        </aside>

        <!-- Chat Main Area -->
        <main class="chat-main" id="chatMain">

            <!-- No Chat Selected State -->
            <div class="chat-empty-state" id="emptyChatState">
                <svg class="chat-empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="1.5">
                    <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" />
                </svg>
                <h3 class="chat-empty-state-title">اختر محادثة للبدء</h3>
                <p class="chat-empty-state-text">اختر محادثة من القائمة للبدء في التواصل</p>
            </div>

            <!-- Active Chat -->
            <div class="active-chat hidden" id="activeChat">

                <!-- Chat Header -->
                <header class="chat-main-header">
                    <button class="chat-back-btn" id="backToList" title="العودة للقائمة">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M15 18l-6-6 6-6" />
                        </svg>
                    </button>

                    <div class="chat-header-user">
                        <div class="chat-header-avatar" id="chatUserAvatar">
                            <img src="" alt="" id="chatUserImg"
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="conversation-avatar-placeholder" id="chatUserInitials" style="display:none;">
                            </div>
                        </div>
                        <div class="chat-header-info">
                            <h3 class="chat-header-name" id="chatUserName">اسم المستخدم</h3>
                            <span class="chat-header-status" id="chatUserStatus">
                                <span class="status-dot online"></span>
                                متصل
                            </span>
                        </div>
                    </div>

                    <div class="chat-header-actions">
                        <a href="#" class="chat-header-action" id="viewOrderLink" title="عرض الطلب">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                                <polyline points="14,2 14,8 20,8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10,9 9,9 8,9" />
                            </svg>
                        </a>
                    </div>
                </header>

                <!-- Order Info Bar -->
                <div class="chat-order-bar" id="chatOrderBar">
                    <div class="chat-order-info">
                        <span class="chat-order-label">الطلب:</span>
                        <span class="chat-order-title" id="chatOrderTitle">عنوان الخدمة</span>
                    </div>
                    <span class="chat-order-status" id="chatOrderStatus">جاري العمل</span>
                </div>

                <!-- Messages Area -->
                <div class="chat-messages-area" id="chatMessagesArea">
                    <!-- Messages will be rendered here -->
                </div>

                <!-- Typing Indicator -->
                <div class="chat-typing hidden" id="chatTyping">
                    <div class="typing-indicator-dots">
                        <span class="typing-indicator-dot"></span>
                        <span class="typing-indicator-dot"></span>
                        <span class="typing-indicator-dot"></span>
                    </div>
                    <span class="typing-indicator-text" id="typingUserName">يكتب...</span>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <form id="chatForm" class="chat-form">
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" class="chat-textarea" placeholder="اكتب رسالتك..." rows="1"
                                maxlength="1000"></textarea>
                            <span class="chat-char-count" id="charCount">0/1000</span>
                        </div>
                        <button type="submit" class="chat-submit-btn" id="submitBtn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13" />
                                <polygon points="22,2 15,22 11,13 2,9" />
                            </svg>
                        </button>
                    </form>
                </div>

                <!-- Chat Locked Overlay -->
                <div class="chat-locked-overlay hidden" id="chatLockedOverlay">
                    <svg class="chat-locked-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                        <path d="M7 11V7a5 5 0 0110 0v4" />
                    </svg>
                    <p class="chat-locked-text">هذه المحادثة مغلقة</p>
                    <span class="chat-locked-reason" id="chatLockedReason">تم إكمال الطلب</span>
                </div>

            </div>

        </main>

    </div>

    <!-- Footer -->
    <div id="footer"></div>

    <!-- Scripts -->
    <script src="/app/js/config.js"></script>
    <script src="/app/js/utils.js"></script>
    <script src="/app/js/auth.js"></script>
    <script src="/app/js/api.js"></script>
    <script src="/app/js/components/toast.js"></script>
    <script src="/app/js/components/loader.js"></script>
    <script src="/app/js/components/navbar.js"></script>
    <script src="/app/js/components/footer.js"></script>

    <!-- Socket.IO for real-time messaging -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="/app/js/socket-client.js"></script>

    <!-- Enhanced Components -->
    <script src="/app/js/components/skeleton.js"></script>
    <script src="/app/js/utils/image-handler.js"></script>

    <script src="/app/js/pages/chat.js"></script>
</body>

</html>